
<title> Explorer </title>
<!-- optimize layout for mobile devices-->
<meta name="viewport" content="width=device-width, initial-scale=0.9">

<style>
    body {
        background-image: url("bg.png");
        background-position: center;

        background-repeat: no-repeat;
        background-size: cover;
    }
    /* Default styles for the button */
/* Default styles for the button */
#google-signin-button {
background-color: #e3eaf5e5;
border-radius: 25px;
border-color: rgb(0, 119, 255);
border-width: 8px;
color: #000000;
font-size: 18px;
font-family: "Segoe UI Emoji", "Noto Color Emoji", "Twemoji";
height: auto;
width: auto;
display: flex;
justify-content: center;
align-items: center;
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
}

#user-data-form {

background-color: #4286f400;
display: flex;
justify-content: center;
align-items: center;
position: absolute;
font-size: large;
font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
top: 280px;
left: 60%;
transform: translate(-50%, -50%);
}
input[type=text] {
border-radius: 5px;
font-size: 25px;
}

input[type="submit" i] {
height: 35px; width: 80px;
font-size: 20px;
}
#rank {
left: 0%;
top: 100%;
font-size: 20px;
font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
text-align: right;
padding: 3px;
height: fit-content;
margin: 5px;
}
#map {
height: 70%;
border: #000000;
background-color: #c5eba2d5;
border-radius: 2px;
border-width: 5px;
}
#button-section {
display: flex;
justify-content: space-around;
align-items: center;
border: #000000;
border-radius: 5px;
border-width: 2px;
background-color:rgb(43, 112, 201);
width: 100%;
height: 10%;
padding: 5px;
margin: 5px;
}
h3{
padding: 5px;
margin: 3px;
}
#text-section {
display: flex;
background-color: #6fc4d3;
border: #000000;
border-radius: 35px;
border-width: 10px;
justify-content: center;
background-color: #8a9fe6bd;
align-items: center;
width: 100%;
height: fit-content;
padding: 5px;
margin: 5px;
}
#text {
font-size: 16px;
font-family:Arial, Helvetica, sans-serif;
text-align: center;
justify-content: center;
padding: 3px;
height: fit-content;
margin: 5px;
}
.button {
font-size: 15px;
font-family:Verdana, Geneva, Tahoma, sans-serif
}
#user-info-bar {
            background-color: #4286f4;
            color: #fff;
            text-align: center;
            padding: 10px;
            font-size: 20px;
        }


</style>

<button id="google-signin-button">&#128526;Login with Google</button>

<script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-firestore.js"></script>

<script>
// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAR3Pg3CXwL3O4wwmDYSGEXP3FBceQi3Dg",
  authDomain: "ham-prg.firebaseapp.com",
  projectId: "ham-prg",
  storageBucket: "ham-prg.appspot.com",
  messagingSenderId: "783612161386",
  appId: "1:783612161386:web:78153c2ba0aed46e51c913",
  measurementId: "G-XCB39N4N8Z"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Initialize Firebase
document.getElementById("google-signin-button").addEventListener("click", function () {
  var provider = new firebase.auth.GoogleAuthProvider();
  
  firebase
    .auth()
    .signInWithPopup(provider)
    .then(function (result) {
      // User signed in with Google
      var user = result.user;
      console.log("Google Sign-In Successful");
      console.log("User ID: " + user.uid);
  
      // empty body, set the page backgroundoad the welcome.gif
      //clear body
      document.body.innerHTML = "";
      document.body.innerHTML = '<img src="welcome.gif" alt="welcome" style="width:100%;height:100%;object-fit:cover;">';
      // check if user already had firebase data or not
      var db = firebase.firestore();
      var docRef = db.collection("users").doc(user.uid);
      docRef
        .get()
        .then(function (doc) {
          if (doc.exists) {
            // user already has data in firestore
            console.log("User data:", doc.data());
            // wait 2 seconds, then redirect to map.html
            setTimeout(function () {
              loadMap();
            }, 2000);

          } else {
            // user does not have data in firestore
            console.log("No user data found");
            document.body.innerHTML = "";
            document.body.style.backgroundImage = 'url("create.gif")';
            document.body.style.backgroundSize = 'cover';
            document.body.style.backgroundPosition = 'center';
            document.body.style.backgroundRepeat = 'no-repeat';
            //ask user what their nickname is 
            document.body.innerHTML += '<form id="user-data-form"><input type="text" id="name" placeholder="Enter your nickname" required><input type="submit" value="Submit"></form></div>';

             
             // listen for form submission
            document.getElementById("user-data-form").addEventListener("submit", function (event) {
              event.preventDefault();
              // get form data
              var name = document.getElementById("name").value;
              var rank = "newbie"
              // write to firestore
              db.collection("users")
                .doc(user.uid)
                .set({
                  name: name,  
                  rank: rank,   
                })
                .then(function () {
                  console.log("New user document successfully written!");
                  // wait 2 seconds, then redirect to map.html
                  setTimeout(function () {
                    // clear the body
                    document.body.innerHTML = "";
                    // load the get_started.gif
                    document.body.innerHTML = "";
                    document.body.style.backgroundImage = 'url("get_started.gif")';
                    document.body.style.backgroundSize = 'cover';
                    document.body.style.backgroundPosition = 'center';
                    document.body.style.backgroundRepeat = 'no-repeat';
                    // add a continue button
                    document.body.innerHTML += '<button id="continue-button">Continue</button>';
                    // if button is clicked, clear body 

                    document.getElementById("continue-button").addEventListener("click", function () {
                      document.body.innerHTML = "";
                      loadMap();
                    });
                  }, 2000);
                })
                .catch(function (error) {
                  console.error("Error writing new user document: ", error);
                });
            });

            
          }
        })
        .catch(function (error) {
          console.log("Error getting user document:", error);
        });
    })
    .catch(function (error) {
      // Handle errors
      console.error("Google Sign-In Failed: " + error.message);
    });
});


function loadMap() {
  
  // clear body
  document.body.innerHTML = '<div id="user-info-bar">Nickname: <span id="nickname">Loading...</span> - Rank: <span id="rank">Loading...</span></div>';

  //set background to  gradient 
  document.body.style.backgroundImage = 'url("bg2.png")';
  // style the page so there are 3 sections, one larger one for a map, one for buttons, one for text
  document.body.style.display = "flex";
  document.body.style.flexDirection = "column";
  document.body.style.justifyContent = "space-between";
  document.body.style.alignItems = "center";
  document.body.style.height = "100vh";
 
  // display the user's name and rank
  var db = firebase.firestore();
  var user = firebase.auth().currentUser;
  var docRef = db.collection("users").doc(user.uid);
  docRef
            .get()
            .then(function (doc) {
                var nickname = doc.data().name;
                var rank = doc.data().rank;

                // Update the user info bar
                document.getElementById("nickname").textContent = nickname;
                document.getElementById("rank").innerHTML = "&#x1F4AF; "+ rank;
            })
            .catch(function (error) {
                console.log("Error getting user document:", error);
            });

  // add a map AND FILL it with the map_demo.png
  document.body.innerHTML += '<div id="map"><img src="map_demo.png" alt="map" style="width:100%;height:100%;object-fit:cover;"></div>';
  // add a button section
  document.body.innerHTML += '<div id="button-section"></div>';
  // add a text section
  document.body.innerHTML += '<div id="text-section"></div>';
  //add four buttons 'challenges', 'legends', 'eat', 'social work'
  document.getElementById("button-section").innerHTML += '<button class="button" id="challenges-button">Challenges</button>';
  document.getElementById("button-section").innerHTML += '<button class="button" id="legends-button">Legends</button>';
  document.getElementById("button-section").innerHTML += '<button class="button" id="eat-button">Eat</button>';
  document.getElementById("button-section").innerHTML += '<button class="button" id="social-work-button">Charity</button>';
  // add a text section
  document.getElementById("text-section").innerHTML += '<div id="text"><h3>Welcome to Explore App!</h2><p>Take part in challenges, quizes, local good deeds, get to know your neighbourhood and have fun!<br> Go from a Newbie to a Local legend and earn badges and achievements :)</div>';

  // add a listener for the challenges button

  // add a listener for the legends button

  // add a listener for the eat button

  // add a listener for the social work button




}
</script>




